import pytest
import tempfile
from dtailor.RunningExamples.Analyzer.AllAndRampAnalyzer import AllAndRampAnalyzer


@pytest.fixture(scope='module')
def allandramp_analyzer(pk_cds_fasta, pk_cai_table):
    dirpath = tempfile.mkdtemp()
    return AllAndRampAnalyzer(input_file=pk_cds_fasta,
                              input_type="FASTA",
                              cai_table=pk_cai_table,
                              ramp_from_to=(0, 39),
                              root_dir=dirpath)


def test_run(allandramp_analyzer):
    analyzed = allandramp_analyzer.run()
    assert analyzed == {'BOH78_0064': {'restCAI': 0.7385987473564803, 'allCAI': 0.7363884372031265, 'mfe': -5.0,
                                       'rampCAI': 0.6973933504722092},
                        'BOH78_0072': {'restCAI': 0.717748891331965, 'allCAI': 0.7187945053198803, 'mfe': -2.6,
                                       'rampCAI': 0.7873926137592664},
                        'BOH78_0062': {'restCAI': 0.7134459420532507, 'allCAI': 0.7143703649696553, 'mfe': 0.0,
                                       'rampCAI': 0.728744161921785},
                        'BOH78_0046': {'restCAI': 0.8174847294479505, 'allCAI': 0.8238079193554364, 'mfe': -8.2,
                                       'rampCAI': 0.8772255854806665},
                        'BOH78_0068': {'restCAI': 0.7812452224986246, 'allCAI': 0.7814537802995655, 'mfe': -9.6,
                                       'rampCAI': 0.7973208216774942},
                        'BOH78_0040': {'restCAI': 0.7140293673435577, 'allCAI': 0.7113874326283661, 'mfe': -6.5,
                                       'rampCAI': 0.6264331461035515},
                        'BOH78_0067': {'restCAI': 0.6719954631430276, 'allCAI': 0.6705090380578541, 'mfe': -4.4,
                                       'rampCAI': 0.6527039256018015},
                        'BOH78_0058': {'restCAI': 0.6425227556547097, 'allCAI': 0.663968079699129, 'mfe': -4.0,
                                       'rampCAI': 0.837635043287714},
                        'BOH78_0029': {'restCAI': 0.6348361598935155, 'allCAI': 0.6521080941436905, 'mfe': -4.6,
                                       'rampCAI': 0.7692379973223316},
                        'BOH78_0071': {'restCAI': 0.6743814470932404, 'allCAI': 0.6793162018501255, 'mfe': -5.6,
                                       'rampCAI': 0.7890492508663426},
                        'BOH78_0028': {'restCAI': 0.7469935580109742, 'allCAI': 0.7519444780311071, 'mfe': -0.2,
                                       'rampCAI': 0.8349242756265874},
                        'BOH78_0050': {'restCAI': 0.5951636447311953, 'allCAI': 0.5930260245829895, 'mfe': -6.8,
                                       'rampCAI': 0.5709602951029817},
                        'BOH78_0051': {'restCAI': 0.5662863059487642, 'allCAI': 0.575667653487373, 'mfe': -3.3,
                                       'rampCAI': 0.6682556548008384},
                        'BOH78_0052': {'restCAI': 0.772715429147918, 'allCAI': 0.7709841379804425, 'mfe': -5.9,
                                       'rampCAI': 0.5941487939090964},
                        'BOH78_0053': {'restCAI': 0.7222428988618562, 'allCAI': 0.7234912876839121, 'mfe': -3.2,
                                       'rampCAI': 0.7770926632885903},
                        'BOH78_0054': {'restCAI': 0.7502371870493537, 'allCAI': 0.7485934699678203, 'mfe': -10.2,
                                       'rampCAI': 0.6043134255945654},
                        'BOH78_0055': {'restCAI': 0.728156827359989, 'allCAI': 0.7290638269605555, 'mfe': -2.0,
                                       'rampCAI': 0.8119117412059726},
                        'BOH78_0056': {'restCAI': 0.8153408415317257, 'allCAI': 0.8139609790561487, 'mfe': -3.5,
                                       'rampCAI': 0.7614331818842369},
                        'BOH78_0034': {'restCAI': 0.6408843250052868, 'allCAI': 0.6420907388137452, 'mfe': -3.4,
                                       'rampCAI': 0.6534291769445238},
                        'BOH78_0038': {'restCAI': 0.7039037853864685, 'allCAI': 0.7050663394972404, 'mfe': -9.0,
                                       'rampCAI': 0.7814203393098612},
                        'BOH78_0039': {'restCAI': 0.6307294931909962, 'allCAI': 0.636259866565894, 'mfe': -3.4,
                                       'rampCAI': 0.6479014577358533},
                        'BOH78_0018': {'restCAI': 0.7744421539164472, 'allCAI': 0.7733544476117307, 'mfe': -4.1,
                                       'rampCAI': 0.7455234719297159},
                        'BOH78_0019': {'restCAI': 0.8265876593319268, 'allCAI': 0.827698518055532, 'mfe': -3.5,
                                       'rampCAI': 0.8317271696952273},
                        'BOH78_0070': {'restCAI': 0.7475431456503978, 'allCAI': 0.7490262706972977, 'mfe': -5.2,
                                       'rampCAI': 0.7820521348738536},
                        'BOH78_0030': {'restCAI': 0.7466020841998284, 'allCAI': 0.7479056290177124, 'mfe': -4.2,
                                       'rampCAI': 0.8269827376036839},
                        'BOH78_0014': {'restCAI': 0.706859381360688, 'allCAI': 0.7101365157580711, 'mfe': -9.7,
                                       'rampCAI': 0.7786883806095345},
                        'BOH78_0015': {'restCAI': 0.7149191587847925, 'allCAI': 0.7215184750660427, 'mfe': -4.4,
                                       'rampCAI': 0.7920755103109843},
                        'BOH78_0016': {'restCAI': 0.7357910279895958, 'allCAI': 0.7346606349431963, 'mfe': -6.2,
                                       'rampCAI': 0.6548029719307203},
                        'BOH78_0017': {'restCAI': 0.7883144448467916, 'allCAI': 0.7851075916790744, 'mfe': -0.5,
                                       'rampCAI': 0.7057141443777935},
                        'BOH78_0010': {'restCAI': 0.8152235412365573, 'allCAI': 0.8177785680225131, 'mfe': -1.6,
                                       'rampCAI': 0.9124333560549995},
                        'BOH78_0011': {'restCAI': 0.7490543195454047, 'allCAI': 0.7483308583740997, 'mfe': -2.3,
                                       'rampCAI': 0.7080175017430482},
                        'BOH78_0012': {'restCAI': 0.7005751534299673, 'allCAI': 0.6990827260018999, 'mfe': -2.1,
                                       'rampCAI': 0.6803027496211985},
                        'BOH78_0013': {'restCAI': 0.7485215281425108, 'allCAI': 0.747837788190715, 'mfe': -4.5,
                                       'rampCAI': 0.7080356211108384},
                        'BOH78_0063': {'restCAI': 0.752669498591724, 'allCAI': 0.7593037013624562, 'mfe': -2.2,
                                       'rampCAI': 0.8522116280578679},
                        'BOH78_0059': {'restCAI': 0.787161663399286, 'allCAI': 0.7817911912836245, 'mfe': -8.1,
                                       'rampCAI': 0.5601710406374651},
                        'BOH78_0061': {'restCAI': 0.6920100450751859, 'allCAI': 0.6922103812312788, 'mfe': -4.5,
                                       'rampCAI': 0.7037729403731036},
                        'BOH78_0035': {'restCAI': 0.7120449938069869, 'allCAI': 0.7101090419179905, 'mfe': -7.3,
                                       'rampCAI': 0.6061278504299206},
                        'BOH78_0069': {'restCAI': 0.7590128546291549, 'allCAI': 0.7606553947588949, 'mfe': -3.9,
                                       'rampCAI': 0.8355846427733922},
                        'BOH78_0032': {'restCAI': 0.7140608169663372, 'allCAI': 0.7137522990752727, 'mfe': -5.7,
                                       'rampCAI': 0.6982630073076987},
                        'BOH78_0031': {'restCAI': 0.7269296262729668, 'allCAI': 0.7261455650152089, 'mfe': -9.0,
                                       'rampCAI': 0.6184927383105445},
                        'BOH78_0033': {'restCAI': 0.6411875950555533, 'allCAI': 0.6451006078225939, 'mfe': -7.3,
                                       'rampCAI': 0.6903982786636241},
                        'BOH78_0057': {'restCAI': 0.7769148056044168, 'allCAI': 0.7771538068502251, 'mfe': -3.2,
                                       'rampCAI': 0.7869233232681029},
                        'BOH78_0023': {'restCAI': 0.7005361301089289, 'allCAI': 0.6955706341657051, 'mfe': -9.8,
                                       'rampCAI': 0.5354883660000713},
                        'BOH78_0060': {'restCAI': 0.7827051987383208, 'allCAI': 0.7813122825811669, 'mfe': -4.1,
                                       'rampCAI': 0.7503616624708233},
                        'BOH78_0008': {'restCAI': 0.7754602785508968, 'allCAI': 0.7995679920985626, 'mfe': -5.2,
                                       'rampCAI': 0.8868633683109259},
                        'BOH78_0065': {'restCAI': 0.7480372643960804, 'allCAI': 0.7488226409517557, 'mfe': -2.4,
                                       'rampCAI': 0.8078523964285216},
                        'BOH78_0049': {'restCAI': 0.607907024248106, 'allCAI': 0.6143410598115906, 'mfe': -3.8,
                                       'rampCAI': 0.6814435877514357},
                        'BOH78_0048': {'restCAI': 0.6529090702794756, 'allCAI': 0.6537481104484446, 'mfe': -6.7,
                                       'rampCAI': 0.6944235617728965},
                        'BOH78_0047': {'restCAI': 0.7572343255679437, 'allCAI': 0.7566408399557835, 'mfe': -3.8,
                                       'rampCAI': 0.7202174100035165},
                        'BOH78_0036': {'restCAI': 0.6621219197116813, 'allCAI': 0.6647241174199026, 'mfe': 0.0,
                                       'rampCAI': 0.6967597943540238},
                        'BOH78_0045': {'restCAI': 0.6534965774551685, 'allCAI': 0.653300256303209, 'mfe': -0.8,
                                       'rampCAI': 0.6528323438372687},
                        'BOH78_0044': {'restCAI': 0.7476678213045342, 'allCAI': 0.7526836339910871, 'mfe': -4.0,
                                       'rampCAI': 0.8227258256149667},
                        'BOH78_0043': {'restCAI': 0.6892479555953442, 'allCAI': 0.6889986663227273, 'mfe': -2.4,
                                       'rampCAI': 0.667299194462036},
                        'BOH78_0042': {'restCAI': 0.7303752230444389, 'allCAI': 0.7354156445698585, 'mfe': -0.1,
                                       'rampCAI': 0.8911163609301836},
                        'BOH78_0041': {'restCAI': 0.7370065141268008, 'allCAI': 0.7336671739317795, 'mfe': -3.2,
                                       'rampCAI': 0.6206256076152239},
                        'BOH78_0037': {'restCAI': 0.6900250274717363, 'allCAI': 0.6979964951525326, 'mfe': -3.3,
                                       'rampCAI': 0.7836478627379022},
                        'BOH78_0003': {'restCAI': 0.7202424908436299, 'allCAI': 0.7227855944219502, 'mfe': -2.6,
                                       'rampCAI': 0.7895796859887584},
                        'BOH78_0002': {'restCAI': 0.6824359280229004, 'allCAI': 0.6792123979371735, 'mfe': -6.6,
                                       'rampCAI': 0.4906311340653401},
                        'BOH78_0001': {'restCAI': 0.6778579801233652, 'allCAI': 0.6764525454528264, 'mfe': -9.6,
                                       'rampCAI': 0.6537312856740467},
                        'BOH78_0066': {'restCAI': 0.7376012892082728, 'allCAI': 0.7404692172007505, 'mfe': -3.4,
                                       'rampCAI': 0.8537802055950302},
                        'BOH78_0007': {'restCAI': 0.7740636062230184, 'allCAI': 0.777421565312455, 'mfe': -4.9,
                                       'rampCAI': 0.8376243694545126},
                        'BOH78_0006': {'restCAI': 0.7320498204145321, 'allCAI': 0.7274193721533914, 'mfe': -2.6,
                                       'rampCAI': 0.5265653581327011},
                        'BOH78_0005': {'restCAI': 0.7371373662051247, 'allCAI': 0.7367057315159649, 'mfe': -2.9,
                                       'rampCAI': 0.7034883272901552},
                        'BOH78_0004': {'restCAI': 0.7491378916599818, 'allCAI': 0.7472498384497211, 'mfe': -4.1,
                                       'rampCAI': 0.7135128465181411},
                        'BOH78_0021': {'restCAI': 0.7255366979287969, 'allCAI': 0.727001032095942, 'mfe': -4.6,
                                       'rampCAI': 0.7649414264668394},
                        'BOH78_0020': {'restCAI': 0.7182840334136106, 'allCAI': 0.717941596964235, 'mfe': -1.6,
                                       'rampCAI': 0.7076142751643761},
                        'BOH78_0009': {'restCAI': 0.7066502592135775, 'allCAI': 0.7086626356426017, 'mfe': -2.9,
                                       'rampCAI': 0.7633783913456542},
                        'BOH78_0022': {'restCAI': 0.7553186115372644, 'allCAI': 0.7541363629213536, 'mfe': -4.4,
                                       'rampCAI': 0.7302599512677759},
                        'BOH78_0025': {'restCAI': 0.7214067805262351, 'allCAI': 0.7194990103589339, 'mfe': -11.6,
                                       'rampCAI': 0.6375043866912551},
                        'BOH78_0024': {'restCAI': 0.6913925724191392, 'allCAI': 0.6888562269010107, 'mfe': -5.6,
                                       'rampCAI': 0.6475004689266955},
                        'BOH78_0027': {'restCAI': 0.6810720382890653, 'allCAI': 0.6781263613619044, 'mfe': -6.3,
                                       'rampCAI': 0.6329022788932339},
                        'BOH78_0026': {'restCAI': 0.6832725523923339, 'allCAI': 0.6776239263969375, 'mfe': -6.1, 'rampCAI': 0.5495733699194523}}